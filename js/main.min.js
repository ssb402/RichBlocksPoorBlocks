$(document).ready(function(){$.getJSON("./js/states.JSON",function(h){var e,l,g,p,q,r,m,b=['<option value="','">',"</option>"],c=$("#state-select"),a;for(a in h)"Washington state"===a||"New York state"===a?c.append(b[0]+a+b[1]+a.replace(" state","")+b[2]):c.append(b[0]+a+b[1]+a+b[2]);c=$("#map-type-select");a=["Income","Rent"];for(var d=0;d<a.length;d++)c.append(b[0]+a[d]+b[1]+a[d]+b[2]);var s,j,t={mapTypeId:google.maps.MapTypeId.ROADMAP};google.maps.event.addDomListener(window,"load",function(){s=new google.maps.Geocoder;j=new google.maps.Map(document.getElementById("map-canvas"),t);s.geocode({address:"United States"},function(a){var b=a[0].geometry.viewport.getSouthWest();a=a[0].geometry.viewport.getNorthEast();b=new google.maps.LatLngBounds(b,a);j.fitBounds(b)});$("#button-mapsize").click(function(){var a=$("#map-canvas"),b=a.height(),f=$("body").height();$("h1,h2,#note").slideToggle();b!=f?a.animate({height:"100%"}):a.animate({height:"75%"})});var a=null,b=new google.maps.InfoWindow;$("#button-search").click(function(){b.close();var c=$("#state-select option:selected").text(),d=$("#map-type-select option:selected").text();if("PICK A STATE"===c||"PICK MAP TYPE"===d)alert('Please pick a state and map type, then click "Search"');else{var c=document.getElementById("address").value,f=document.getElementById("state-select").value,t=h[f].tableId;"Income"===d?(g="median_hh_income > 0 AND error > 0","colorblind"===$("input[name=colorblind]:checked").val()?(e=3,l="styleNum3.png"):(e=2,l="styleNum2.png"),p=0.4,q="median_hh_income",r="error",rangeType="medianIncome",m="Median household income",infoWindow2="Statewide middle-class income range"):"Rent"===d&&(g="median_rent > 0",e=4,p=0.6,l="styleNum4.png",q="median_rent",r="rent_error",rangeType="medianRent",m="Median monthly rent",infoWindow2="Statewide middle rental-range");var u=m.toLowerCase(),v={query:{select:"geometry",from:t,where:g},styles:[{polygonOptions:{strokeColor:"#ffffff",strokeOpacity:0.3,fillOpacity:p}}],styleId:e,suppressInfoWindows:!0};s.geocode({address:c+","+f},function(c,d){if(d===google.maps.GeocoderStatus.OK){var k=c[0].geometry.viewport.getSouthWest(),e=c[0].geometry.viewport.getNorthEast(),k=new google.maps.LatLngBounds(k,e);j.fitBounds(k);null===a?(a=new google.maps.FusionTablesLayer(v),a.setMap(j)):a.setOptions(v);google.maps.event.addListener(a,"click",function(a){var c=accounting.formatMoney(a.row[q].value),d=accounting.formatMoney(a.row[r].value),e=accounting.formatMoney(h[f][rangeType].percent40),g=accounting.formatMoney(h[f][rangeType].percent60);a.infoWindowHtml=["<b>"+a.row.label.value+".</b>","<b>"+m+":</b> "+c+" (+/- "+d+").","<b>"+infoWindow2+":</b> "+e+" to "+g+". <br>",'<i>All data come from the 2007-2011 <a href="http://www.census.gov/acs/www/" target="_0">American Community Survey</a>. The statewide middle range covers Census Tracts which have a '+u+" higher than the lowest 40 percent -- and lower than the highest 40 percent -- of this state's Census Tracts.</i>"];b.setContent('<div class="info-window">'+a.infoWindowHtml.join("<br>")+"</div>");b.setPosition(a.latLng);b.open(j)});var k=accounting.formatMoney(h[f][rangeType].percent5),e=accounting.formatMoney(h[f][rangeType].percent95),g=['<h3 id="legend-title">'+f+" "+u+' (in 2011 dollars)</h3> <div id="legend-labels">','<span id="bottom5">'+k+" or less</span>",'<img id="gradient" src="./images/'+l+'" />','<span id="top5">'+e+" or more</span>"],n=$("div#legend");0===$("div#legend").length?(n=document.createElement("div"),n.id="legend",n.innerHTML=g.join(""),j.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(n)):$("div#legend").html(g.join(""));$("#legend-title").html(f+" "+u+" (in 2011 dollars)");$("#bottom5").html(k+" or less");$("#top5").html(e+" or more")}else alert("Couldn't find address for the following reason: "+d+". Sorry about that. Please try another address.")})}})})})});