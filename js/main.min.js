$(document).ready(function(){$.getJSON("./js/states.JSON",function(h){var b=['<option value="','">',"</option>"],c=$("#state-select"),a;for(a in h)"Washington state"===a||"New York state"===a?c.append(b[0]+a+b[1]+a.replace(" state","")+b[2]):c.append(b[0]+a+b[1]+a+b[2]);c=$("#map-type-select");a=["Income","Rent"];for(var g=0;g<a.length;g++)c.append(b[0]+a[g]+b[1]+a[g]+b[2]);var r,j,y={mapTypeId:google.maps.MapTypeId.ROADMAP};google.maps.event.addDomListener(window,"load",function(){r=new google.maps.Geocoder;j=new google.maps.Map(document.getElementById("map-canvas"),y);r.geocode({address:"United States"},function(d){var a=d[0].geometry.viewport.getSouthWest();d=d[0].geometry.viewport.getNorthEast();a=new google.maps.LatLngBounds(a,d);j.fitBounds(a)})});$("#button-mapsize").click(function(){var a=$("#map-canvas"),b=a.height(),e=$("body").height();$("h1,h2,#note").slideToggle();b!=e?a.animate({height:"100%"}):a.animate({height:"75%"})});var f,n,s,t,u,v,p,k=[],l=[],m=null,w=new google.maps.InfoWindow;$("#button-search").click(function(){var a=$("#state-select option:selected").text(),b=$("#map-type-select option:selected").text();if("PICK A STATE"===a||"PICK MAP TYPE"===b)alert('Please pick a state and map type, then click "Search"');else{var a=document.getElementById("address").value,e=document.getElementById("state-select").value,c=h[e].tableId;k.push(a);l.push(e);"Income"===b?(s="median_hh_income > 0 AND error > 0","colorblind"===$("input[name=colorblind]:checked").val()?(f=3,n="styleNum3.png"):(f=2,n="styleNum2.png"),t=0.4,u="median_hh_income",v="error",rangeType="medianIncome",p="Median household income",infoWindow2="Statewide middle-class income range"):"Rent"===b&&(s="median_rent > 0",f=4,t=0.6,n="styleNum4.png",u="median_rent",v="rent_error",rangeType="medianRent",p="Median monthly rent",infoWindow2="Statewide middle rental-range");var g=p.toLowerCase(),x={query:{select:"geometry",from:c,where:s},styles:[{polygonOptions:{strokeColor:"#ffffff",strokeOpacity:0.3,fillOpacity:t}}],styleId:f,suppressInfoWindows:!0};r.geocode({address:a+","+e},function(a,b){if(b===google.maps.GeocoderStatus.OK){if(l[l.length-2]!=l[l.length-1]||k[k.length-2]!=k[k.length-1]){var c=a[0].geometry.viewport.getSouthWest(),d=a[0].geometry.viewport.getNorthEast(),c=new google.maps.LatLngBounds(c,d);j.fitBounds(c)}null===m?(m=new google.maps.FusionTablesLayer(x),m.setMap(j)):m.setOptions(x);google.maps.event.addListener(m,"click",function(a){var b=accounting.formatMoney(a.row[u].value),c=accounting.formatMoney(a.row[v].value),d=accounting.formatMoney(h[e][rangeType].percent40),f=accounting.formatMoney(h[e][rangeType].percent60);a.infoWindowHtml=["<b>"+a.row.label.value+".</b>","<b>"+p+":</b> "+b+" (+/- "+c+").","<b>"+infoWindow2+":</b> "+d+" to "+f+". <br>",'<i>All data come from the 2007-2011 <a href="http://www.census.gov/acs/www/" target="_0">American Community Survey</a>. The statewide middle range covers Census Tracts which have a '+g+" higher than the lowest 40 percent -- and lower than the highest 40 percent -- of this state's Census Tracts.</i>"];w.setContent('<div class="info-window">'+a.infoWindowHtml.join("<br>")+"</div>");w.setPosition(a.latLng);w.open(j)});var c=accounting.formatMoney(h[e][rangeType].percent5),d=accounting.formatMoney(h[e][rangeType].percent95),f=['<h3 id="legend-title">'+e+" "+g+' (in 2011 dollars)</h3> <div id="legend-labels">','<span id="bottom5">'+c+" or less</span>",'<img id="gradient" src="./images/'+n+'" />','<span id="top5">'+d+" or more</span>"],q=$("div#legend");0===$("div#legend").length?(q=document.createElement("div"),q.id="legend",q.innerHTML=f.join(""),j.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(q)):$("div#legend").html(f.join(""));$("#legend-title").html(e+" "+g+" (in 2011 dollars)");$("#bottom5").html(c+" or less");$("#top5").html(d+" or more")}else alert("Couldn't find address for the following reason: "+b+". Sorry about that. Please try another address.")})}})})});