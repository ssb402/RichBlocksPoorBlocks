(function(q,A){function r(a){return!!(""===a||a&&a.charCodeAt&&a.substr)}function m(a){return v?v(a):"[object Array]"===w.call(a)}function s(a){return"[object Object]"===w.call(a)}function t(a,b){var d,a=a||{},b=b||{};for(d in b)b.hasOwnProperty(d)&&null==a[d]&&(a[d]=b[d]);return a}function j(a,b,d){var c=[],e,h;if(!a)return c;if(x&&a.map===x)return a.map(b,d);e=0;for(h=a.length;e<h;e++)c[e]=b.call(d,a[e],e,a);return c}function n(a,b){a=Math.round(Math.abs(a));return isNaN(a)?b:a}function y(a){var b= c.settings.currency.format;"function"===typeof a&&(a=a());return r(a)&&a.match("%v")?{pos:a,neg:a.replace("-","").replace("%v","-%v"),zero:a}:!a||!a.pos||!a.pos.match("%v")?!r(b)?b:c.settings.currency.format={pos:b,neg:b.replace("%v","-%v"),zero:b}:a}var c={version:"0.3.2",settings:{currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}}},x=Array.prototype.map,v=Array.isArray,w=Object.prototype.toString,p=c.unformat= c.parse=function(a,b){if(m(a))return j(a,function(a){return p(a,b)});a=a||0;if("number"===typeof a)return a;var b=b||".",c=RegExp("[^0-9-"+b+"]",["g"]),c=parseFloat((""+a).replace(/\((.*)\)/,"-$1").replace(c,"").replace(b,"."));return!isNaN(c)?c:0},z=c.toFixed=function(a,b){var b=n(b,c.settings.number.precision),d=Math.pow(10,b);return(Math.round(c.unformat(a)*d)/d).toFixed(b)},u=c.formatNumber=function(a,b,d,i){if(m(a))return j(a,function(a){return u(a,b,d,i)});var a=p(a),e=t(s(b)?b:{precision:b, thousand:d,decimal:i},c.settings.number),h=n(e.precision),f=0>a?"-":"",g=parseInt(z(Math.abs(a||0),h),10)+"",l=3<g.length?g.length%3:0;return f+(l?g.substr(0,l)+e.thousand:"")+g.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+e.thousand)+(h?e.decimal+z(Math.abs(a),h).split(".")[1]:"")},B=c.formatMoney=function(a,b,d,i,e,h){if(m(a))return j(a,function(a){return B(a,b,d,i,e,h)});var a=p(a),f=t(s(b)?b:{symbol:b,precision:d,thousand:i,decimal:e,format:h},c.settings.currency),g=y(f.format);return(0<a?g.pos:0> a?g.neg:g.zero).replace("%s",f.symbol).replace("%v",u(Math.abs(a),n(f.precision),f.thousand,f.decimal))};c.formatColumn=function(a,b,d,i,e,h){if(!a)return[];var f=t(s(b)?b:{symbol:b,precision:d,thousand:i,decimal:e,format:h},c.settings.currency),g=y(f.format),l=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,k=0,a=j(a,function(a){if(m(a))return c.formatColumn(a,f);a=p(a);a=(0<a?g.pos:0>a?g.neg:g.zero).replace("%s",f.symbol).replace("%v",u(Math.abs(a),n(f.precision),f.thousand,f.decimal));a.length>k&& (k=a.length);return a});return j(a,function(a){return r(a)&&a.length<k?l?a.replace(f.symbol,f.symbol+Array(k-a.length+1).join(" ")):Array(k-a.length+1).join(" ")+a:a})};if("undefined"!==typeof exports)"undefined"!==typeof module&&module.exports&&(exports=module.exports=c),exports.accounting=c;else if("function"===typeof define&&define.amd)define([],function(){return c});else{var C=q.accounting;c.noConflict=function(){q.accounting=C;c.noConflict=A;return c};q.accounting=c}})(this);